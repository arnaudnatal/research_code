# plot by key
df_long  %>%
ggplot(aes(x= time, y= value, color= key)) +
geom_line( size=0.2) +
ggtitle("Control chart sequences") +
facet_wrap(~ key , scales = 'free_x', nrow= 2)
df_list <- as.list(utils::unstack(df_long, value ~ key))
df_list_z <- dtwclust::zscore(df_list)
View(df_list_z)
cluster_dtw_h <-list()
for (i in 2:20)
{
cluster_dtw_h[[i]] <- tsclust(df_list_z, type = "h", k = i,  distance = "dtw", control = hierarchical_control(method = "complete"), seed = 390, preproc = NULL, args = tsclust_args(dist = list(window.size = 5L)))
}
cluster_dtw_h[[20]]
View(df_long)
cluster_dtw_h <-list()
for (i in 2:19)
{
cluster_dtw_h[[i]] <- tsclust(df_list_z, type = "h", k = i,  distance = "dtw", control = hierarchical_control(method = "complete"), seed = 390, preproc = NULL, args = tsclust_args(dist = list(window.size = 5L)))
}
cluster_dtw_h[[19]]
cluster_dtw_h[[4]]@clusinfoter_dtw_h[[4]]@clusinfo
# plot dendrogram for k= 4
plot(cluster_dtw_h[[4]])
install.packages("dtw", dependencies=TRUE)
install.packages("dtw", dependencies = TRUE)
#install.packages("dtw", dependencies=TRUE)
sc <- read.table("C:/Users/Arnaud/Downloads/synthetic_control.data", header=F, sep=”")
sc <- read.table("C:/Users/Arnaud/Downloads/synthetic_control.data", header=F, sep=")
rm(list = ls())
)
1
STOP
f
rm(list = ls())
sc <- read.table("C:/Users/Arnaud/Downloads/synthetic_control.data", header=F, sep="")
View(sc)
n <- 10
s <- sample(1:100, n)
idx <- c(s, 100+s, 200+s, 300+s, 400+s, 500+s)
sample2 <- sc[idx,]
observedLabels <- c(rep(1,n), rep(2,n), rep(3,n), rep(4,n), rep(5,n), rep(6,n))
View(sample2)
library(dtw)
distMatrix <- dist(sample2, method="DTW")
hc <- hclust(distMatrix, method="average")
plot(hc, labels=observedLabels, main="")
#install.packages("dtw", dependencies=TRUE)
rm(list = ls())
sc <- read.table("C:/Users/Arnaud/Downloads/synthetic_control.data", header=F, sep="")
# randomly sampled n cases from each class, to make it easy for plotting
n <- 10
s <- sample(1:100, n)
idx <- c(s, 100+s, 200+s, 300+s, 400+s, 500+s)
sample2 <- sc[idx,]
observedLabels <- c(rep(1,n), rep(2,n), rep(3,n), rep(4,n), rep(5,n), rep(6,n))
View(sample2)
rm(list = ls())
# synthetically generated control charts
# install.packages("tidyr", dependencies = TRUE)
# install.packages("dtwclust", dependencies = TRUE)
# install.packages("dplyr", dependencies = TRUE)
# install.packages("reshape", dependencies = TRUE)
library(tidyr)
library(dtwclust)
library(dplyr)
library(ggplot2)
library(reshape)
df <- read.table("http://kdd.ics.uci.edu/databases/synthetic_control/synthetic_control.data",
header = FALSE)
# wide to long
df_long <- gather(df[c(1:50),c(1:20)])
# make a timepoint column
df_long$time <- rep(1:50,20)
# plot by key
df_long  %>%
ggplot(aes(x= time, y= value, color= key)) +
geom_line( size=0.2) +
ggtitle("Control chart sequences") +
facet_wrap(~ key , scales = 'free_x', nrow= 2)
View(df_long)
df_list <- as.list(utils::unstack(df_long, value ~ key))
View(df_list)
rm(list = ls())
rm(list = ls())
library(tidyverse)
library(lubridate)
library(pwt9)
library(brotools)
install.packages("tidyverse")
install.packages("lubridate")
install.packages("pwt9")
install.packages("brotools")
install.packages("lubridate")
library(tidyverse)
library(lubridate)
library(pwt9)
library(brotools)
pwt <- pwt9.0 %>%
select(country, year, avh)
View(pwt)
pwt_wide <- pwt %>%
pivot_wider(names_from = year, values_from = avh)  %>%
filter(!is.na(`1950`)) %>%
mutate_at(vars(-country), as.numeric)
View(pwt_wide)
View(pwt_wide)
wss <- map_dbl(1:5, ~{kmeans(select(pwt_wide, -country), ., nstart=50,iter.max = 15 )$tot.withinss})
n_clust <- 1:5
elbow_df <- as.data.frame(cbind("n_clust" = n_clust, "wss" = wss))
ggplot(elbow_df) +
geom_line(aes(y = wss, x = n_clust), colour = "#82518c") +
theme_blog()
ggplot(elbow_df) +
geom_line(aes(y = wss, x = n_clust), colour = "#82518c")
clusters <- kmeans(select(pwt_wide, -country), centers = 3)
(centers <- rownames_to_column(as.data.frame(clusters$centers), "cluster"))
pwt_wide <- pwt_wide %>%
mutate(cluster = clusters$cluster)
pwt_long <- pwt_wide %>%
pivot_longer(cols=c(-country, -cluster), names_to = "year", values_to = "avh") %>%
mutate(year = ymd(paste0(year, "-01-01")))
centers_long <- centers %>%
pivot_longer(cols = -cluster, names_to = "year", values_to = "avh") %>%
mutate(year = ymd(paste0(year, "-01-01")))
ggplot() +
geom_line(data = pwt_long, aes(y = avh, x = year, group = country), colour = "#82518c") +
facet_wrap(~cluster, nrow = 1) +
geom_line(data = centers_long, aes(y = avh, x = year, group = cluster), col = "#b58900", size = 2) +
labs(title = "Average hours worked in several countries",
caption = "The different time series have been clustered using k-means.
Cluster 1: Belgium, Switzerland, Germany, Denmark, France, Luxembourg, Netherlands,
Norway, Sweden.\nCluster 2: Australia, Colombia, Ireland, Iceland, Japan, Mexico,
Portugal, Turkey.\nCluster 3: Argentina, Austria, Brazil, Canada, Cyprus, Spain, Finland,
UK, Italy, New Zealand, Peru, USA, Venezuela") +
theme(plot.caption = element_text(colour = "white"))
# Arnaud NATAL
# University of Bordeaux
# arnaud.natal@u-bordeaux.fr
# Debt trend analysis
# April 28, 2022
#--- Introduction
rm(list = ls())
setwd("C:/Users/Arnaud/Documents/GitHub/Analysis/Overindebtedness")
#--- Install packages
# install.packages("tidyr", dependencies = TRUE)
# install.packages("dtwclust", dependencies = TRUE)
# install.packages("dplyr", dependencies = TRUE)
# install.packages('RStata')
#--- Open packages
library(tidyr)
library(dtwclust)
library(dplyr)
library(ggplot2)
library(RStata)
#--- Open datasets
data<-read.csv("debttrend.csv")
attach(data)
#--- Matrices creation
X_loan<-as.matrix(cbind(loanamount1,loanamount2,loanamount3))
X_loan_cro<-as.matrix(cbind(cro_loanamount1,cro_loanamount2,cro_loanamount3))
X_loan_ihs<-as.matrix(cbind(ihs_loanamount1,ihs_loanamount2,ihs_loanamount3))
X_loan_log<-as.matrix(cbind(log_loanamount1,log_loanamount2,log_loanamount3))
interactive_clustering(X_loan)
interactive_clustering(X_loan_log)
interactive_clustering(X_loan)
interactive_clustering(X_loan_cro)
X_loan_log<-as.matrix(cbind(log_loanamount1,log_loanamount2,log_loanamount3))
X_income_log<-as.matrix(cbind(log_income1,log_income2,log_income3))
X_assets_log<-as.matrix(cbind(log_assets1,log_assets2,log_assets3))
# Arnaud NATAL
# University of Bordeaux
# arnaud.natal@u-bordeaux.fr
# Debt trend analysis
# April 28, 2022
#--- Introduction
rm(list = ls())
setwd("C:/Users/Arnaud/Documents/GitHub/Analysis/Overindebtedness")
#--- Install packages
# install.packages("tidyr", dependencies = TRUE)
# install.packages("dtwclust", dependencies = TRUE)
# install.packages("dplyr", dependencies = TRUE)
# install.packages('RStata')
#--- Open packages
library(tidyr)
library(dtwclust)
library(dplyr)
library(ggplot2)
library(RStata)
#--- Open datasets
data<-read.csv("debttrend.csv")
attach(data)
View(data)
data<-read.csv("debttrend.csv")
attach(data)
#--- Matrices creation
X_loan_log<-as.matrix(cbind(log_loanamount1,log_loanamount2,log_loanamount3))
X_income_log<-as.matrix(cbind(log_annualincome1,log_annualincome2,log_annualincome3))
X_assets_log<-as.matrix(cbind(log_assets_noland1,log_assets_noland2,log_assets_noland3))
interactive_clustering(X_income_log)
interactive_clustering(X_assets_log)
interactive_clustering(X_assets_log)
interactive_clustering(X_loan_log)
interactive_clustering(X_assets_log)
interactive_clustering(X_income_log)
View(data)
X_expenses_log<-as.matrix(cbind(log_yearly_expenses1,log_yearly_expenses2,log_yearly_expenses3))
interactive_clustering(X_expenes_log)
interactive_clustering(X_expenses_log)
interactive_clustering(X_loan_log)
X_loan<-as.matrix(cbind(loanamount1,loanamount2,loanamount3))
X_income<-as.matrix(cbind(annualincome1,annualincome2,annualincome3))
X_assets<-as.matrix(cbind(assets_noland1,assets_noland2,assets_noland3))
X_expenses<-as.matrix(cbind(yearly_expenses1,yearly_expenses2,yearly_expenses3))
interactive_clustering(X_loan)
# Arnaud NATAL
# University of Bordeaux
# arnaud.natal@u-bordeaux.fr
# Debt trend analysis
# April 28, 2022
#--- Introduction
rm(list = ls())
setwd("C:/Users/Arnaud/Documents/GitHub/Analysis/Overindebtedness")
#--- Install packages
# install.packages("tidyr", dependencies = TRUE)
# install.packages("dtwclust", dependencies = TRUE)
# install.packages("dplyr", dependencies = TRUE)
# install.packages('RStata')
#--- Open packages
library(tidyr)
library(dtwclust)
library(dplyr)
library(ggplot2)
library(RStata)
#--- Open datasets
data<-read.csv("debttrend.csv")
attach(data)
View(data)
X_loan<-as.matrix(cbind(loanamount1,loanamount2,loanamount3))
X_income<-as.matrix(cbind(annualincome1,annualincome2,annualincome3))
X_assets<-as.matrix(cbind(assets_noland1,assets_noland2,assets_noland3))
X_expenses<-as.matrix(cbind(yearly_expenses1,yearly_expenses2,yearly_expenses3))
X_loan_log<-as.matrix(cbind(log_loanamount1,log_loanamount2,log_loanamount3))
X_income_log<-as.matrix(cbind(log_annualincome1,log_annualincome2,log_annualincome3))
X_assets_log<-as.matrix(cbind(log_assets_noland1,log_assets_noland2,log_assets_noland3))
X_expenses_log<-as.matrix(cbind(log_yearly_expenses1,log_yearly_expenses2,log_yearly_expenses3))
interactive_clustering(X_loan)
View(data)
# Arnaud NATAL
# University of Bordeaux
# arnaud.natal@u-bordeaux.fr
# Debt trend analysis
# April 28, 2022
#--- Introduction
rm(list = ls())
setwd("C:/Users/Arnaud/Documents/GitHub/Analysis/Overindebtedness")
#--- Install packages
# install.packages("tidyr", dependencies = TRUE)
# install.packages("dtwclust", dependencies = TRUE)
# install.packages("dplyr", dependencies = TRUE)
# install.packages('RStata')
#--- Open packages
library(tidyr)
library(dtwclust)
library(dplyr)
library(ggplot2)
library(RStata)
#--- Open datasets
data<-read.csv("debttrend.csv")
attach(data)
#--- Matrices creation
# X_loan<-as.matrix(cbind(loanamount1,loanamount2,loanamount3))
# X_income<-as.matrix(cbind(annualincome1,annualincome2,annualincome3))
# X_assets<-as.matrix(cbind(assets_noland1,assets_noland2,assets_noland3))
# X_expenses<-as.matrix(cbind(yearly_expenses1,yearly_expenses2,yearly_expenses3))
X_loan_log<-as.matrix(cbind(log_loanamount1,log_loanamount2,log_loanamount3))
X_income_log<-as.matrix(cbind(log_annualincome1,log_annualincome2,log_annualincome3))
X_assets_log<-as.matrix(cbind(log_assets_noland1,log_assets_noland2,log_assets_noland3))
X_expenses_log<-as.matrix(cbind(log_yearly_expenses1,log_yearly_expenses2,log_yearly_expenses3))
#--- Trends analysis clustering
# interactive_clustering(X_loan)
# interactive_clustering(X_income)
# interactive_clustering(X_assets)
# interactive_clustering(X_expenses)
# interactive_clustering(X_loan_log)
# interactive_clustering(X_income_log)
# interactive_clustering(X_assets_log)
# interactive_clustering(X_expenses_log)
#--- Manually trends analysis
loan<-tsclust(
series=X_loan_log,
type="partitional",
k=3,
distance="sbd",
centroid="median",
seed=1,
trace=TRUE,
error.check=TRUE
)
assets<-tsclust(
series=X_assets_log,
type="partitional",
k=4,
distance="sbd",
centroid="median",
seed=5,
trace=TRUE,
error.check=TRUE
)
income<-tsclust(
series=X_income_log,
type="partitional",
k=4,
distance="sbd",
centroid="median",
seed=1,
trace=TRUE,
error.check=TRUE
)
expenses<-tsclust(
series=X_expenses_log,
type="partitional",
k=3,
distance="sbd",
centroid="median",
seed=1,
trace=TRUE,
error.check=TRUE
)
cl_loan<-loan@cluster
cl_income<-income@cluster
cl_assets<-assets@cluster
cl_expenses<-expenses@cluster
data<-cbind(data,cl_loan,cl_income,cl_assets,cl_expenses)
write.csv(data,"debttrendRreturn.csv")
# Arnaud NATAL
# University of Bordeaux
# arnaud.natal@u-bordeaux.fr
# Debt trend analysis
# April 28, 2022
#--- Introduction
rm(list = ls())
setwd("C:/Users/Arnaud/Documents/GitHub/Analysis/Overindebtedness")
#--- Install packages
# install.packages("tidyr", dependencies = TRUE)
# install.packages("dtwclust", dependencies = TRUE)
# install.packages("dplyr", dependencies = TRUE)
# install.packages('RStata')
#--- Open packages
library(tidyr)
library(dtwclust)
library(dplyr)
library(ggplot2)
library(RStata)
#--- Open datasets
data<-read.csv("debttrend.csv")
attach(data)
#--- Matrices creation
# X_loan<-as.matrix(cbind(loanamount1,loanamount2,loanamount3))
# X_income<-as.matrix(cbind(annualincome1,annualincome2,annualincome3))
# X_assets<-as.matrix(cbind(assets_noland1,assets_noland2,assets_noland3))
# X_expenses<-as.matrix(cbind(yearly_expenses1,yearly_expenses2,yearly_expenses3))
X_loan_log<-as.matrix(cbind(log_loanamount1,log_loanamount2,log_loanamount3))
X_income_log<-as.matrix(cbind(log_annualincome1,log_annualincome2,log_annualincome3))
X_assets_log<-as.matrix(cbind(log_assets_noland1,log_assets_noland2,log_assets_noland3))
X_expenses_log<-as.matrix(cbind(log_yearly_expenses1,log_yearly_expenses2,log_yearly_expenses3))
#--- Trends analysis clustering
# interactive_clustering(X_loan)
# interactive_clustering(X_income)
# interactive_clustering(X_assets)
# interactive_clustering(X_expenses)
# interactive_clustering(X_loan_log)
# interactive_clustering(X_income_log)
# interactive_clustering(X_assets_log)
# interactive_clustering(X_expenses_log)
#--- Manually trends analysis
loan<-tsclust(
series=X_loan_log,
type="partitional",
k=3,
distance="sbd",
centroid="median",
seed=1,
trace=TRUE,
error.check=TRUE
)
assets<-tsclust(
series=X_assets_log,
type="partitional",
k=4,
distance="sbd",
centroid="median",
seed=5,
trace=TRUE,
error.check=TRUE
)
income<-tsclust(
series=X_income_log,
type="partitional",
k=4,
distance="sbd",
centroid="median",
seed=1,
trace=TRUE,
error.check=TRUE
)
expenses<-tsclust(
series=X_expenses_log,
type="partitional",
k=3,
distance="sbd",
centroid="median",
seed=1,
trace=TRUE,
error.check=TRUE
)
#--- Datasets extraction
cl_loan<-loan@cluster
cl_income<-income@cluster
cl_assets<-assets@cluster
cl_expenses<-expenses@cluster
data<-cbind(data,cl_loan,cl_income,cl_assets,cl_expenses)
write.csv(data,"debttrendRreturn.csv")
# Arnaud NATAL
# University of Bordeaux
# arnaud.natal@u-bordeaux.fr
# Debt trend analysis
# April 28, 2022
#--- Introduction
rm(list = ls())
setwd("C:/Users/Arnaud/Documents/GitHub/Analysis/Overindebtedness")
#--- Install packages
# install.packages("tidyr", dependencies = TRUE)
# install.packages("dtwclust", dependencies = TRUE)
# install.packages("dplyr", dependencies = TRUE)
# install.packages('RStata')
#--- Open packages
library(tidyr)
library(dtwclust)
library(dplyr)
library(ggplot2)
library(RStata)
#--- Open datasets
data<-read.csv("debttrend.csv")
attach(data)
#--- Matrices creation
# X_loan<-as.matrix(cbind(loanamount1,loanamount2,loanamount3))
# X_income<-as.matrix(cbind(annualincome1,annualincome2,annualincome3))
# X_assets<-as.matrix(cbind(assets_noland1,assets_noland2,assets_noland3))
# X_expenses<-as.matrix(cbind(yearly_expenses1,yearly_expenses2,yearly_expenses3))
X_loan_log<-as.matrix(cbind(log_loanamount1,log_loanamount2,log_loanamount3))
X_income_log<-as.matrix(cbind(log_annualincome1,log_annualincome2,log_annualincome3))
X_assets_log<-as.matrix(cbind(log_assets_noland1,log_assets_noland2,log_assets_noland3))
X_expenses_log<-as.matrix(cbind(log_yearly_expenses1,log_yearly_expenses2,log_yearly_expenses3))
#--- Trends analysis clustering
# interactive_clustering(X_loan)
# interactive_clustering(X_income)
# interactive_clustering(X_assets)
# interactive_clustering(X_expenses)
# interactive_clustering(X_loan_log)
# interactive_clustering(X_income_log)
# interactive_clustering(X_assets_log)
# interactive_clustering(X_expenses_log)
#--- Manually trends analysis
loan<-tsclust(
series=X_loan_log,
type="partitional",
k=3,
distance="sbd",
centroid="median",
seed=1,
trace=TRUE,
error.check=TRUE
)
assets<-tsclust(
series=X_assets_log,
type="partitional",
k=4,
distance="sbd",
centroid="median",
seed=5,
trace=TRUE,
error.check=TRUE
)
income<-tsclust(
series=X_income_log,
type="partitional",
k=4,
distance="sbd",
centroid="median",
seed=1,
trace=TRUE,
error.check=TRUE
)
expenses<-tsclust(
series=X_expenses_log,
type="partitional",
k=3,
distance="sbd",
centroid="median",
seed=1,
trace=TRUE,
error.check=TRUE
)
#--- Datasets extraction
cl_loanamount<-loan@cluster
cl_annualincome<-income@cluster
cl_assets_noland<-assets@cluster
cl_yearly_expenses<-expenses@cluster
data<-cbind(data,cl_loanamount,cl_annualincome,cl_assets_noland,cl_yearly_expenses)
write.csv(data,"debttrendRreturn.csv")
